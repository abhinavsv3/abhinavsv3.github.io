---
import BaseLayout from '../layouts/BaseLayout.astro';

const posts = await Astro.glob('./blog/*.{md,mdx}');
const sortedPosts = posts.sort(
  (a, b) => new Date(b.frontmatter.pubDate).valueOf() - new Date(a.frontmatter.pubDate).valueOf()
);

const formatDate = (date: string) => {
  return new Date(date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
};

// Group posts by year
const postsByYear = sortedPosts.reduce((acc, post) => {
  const year = new Date(post.frontmatter.pubDate).getFullYear();
  if (!acc[year]) acc[year] = [];
  acc[year].push(post);
  return acc;
}, {} as Record<number, typeof posts>);

const years = Object.keys(postsByYear).sort((a, b) => Number(b) - Number(a));
---

<BaseLayout title="Writing | Scaling Thoughts" description="All blog posts and articles.">
  <div class="max-w-3xl mx-auto px-6 py-12">
    <header class="mb-12">
      <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-gray-100 mb-4">
        Writing
      </h1>
      <p class="text-gray-600 dark:text-gray-400">
        All my blog posts, organized by year.
      </p>
    </header>

    {years.length > 0 ? (
      <div class="space-y-12">
        {years.map((year) => (
          <section>
            <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-6">
              {year}
            </h2>
            <ul class="space-y-6">
              {postsByYear[Number(year)].map((post) => (
                <li>
                  <a href={post.url} class="group block">
                    <article class="flex flex-col sm:flex-row sm:items-baseline gap-2 sm:gap-4">
                      <time
                        datetime={post.frontmatter.pubDate}
                        class="text-sm text-gray-500 dark:text-gray-400 shrink-0 w-28"
                      >
                        {formatDate(post.frontmatter.pubDate)}
                      </time>
                      <div>
                        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 group-hover:text-accent dark:group-hover:text-accent-dark transition-colors">
                          {post.frontmatter.title}
                        </h3>
                        {post.frontmatter.description && (
                          <p class="text-gray-600 dark:text-gray-400 mt-1">
                            {post.frontmatter.description}
                          </p>
                        )}
                      </div>
                    </article>
                  </a>
                </li>
              ))}
            </ul>
          </section>
        ))}
      </div>
    ) : (
      <p class="text-gray-500 dark:text-gray-400">
        No posts yet. Check back soon!
      </p>
    )}
  </div>
</BaseLayout>
